# スマホで開発サーバーに接続する

PCで動かしている開発サーバー（http://localhost:3000）を、同じWi‑Fiのスマホから開く手順です。

---

## ⚠️ 「net::ERR_CONNECTION_TIMED_OUT」が出る場合

**スマホからPCへの接続が届いていません。** 多い原因は次の2つです。

### 原因1: Windowsファイアウォール（いちばん多い）

ポート 3000 への接続がブロックされています。**管理者のPowerShell**で次を実行して、受信を許可してください。

```powershell
# 管理者としてPowerShellを開いて実行（プライベート＋パブリック両方で許可）
New-NetFirewallRule -DisplayName "Next.js dev (3000)" -Direction Inbound -LocalPort 3000 -Protocol TCP -Action Allow -Profile Any
```

- 「**Windows キー**」→「**PowerShell**」と入力 → **「管理者として実行」** で開く  
- 上記を貼り付けて Enter  
- 「既に存在する」と出たら、そのままでもOK（すでに許可済み）  
- スマホでもう一度 **http://100.64.1.103:3000**（または show-url.ps1 で表示したURL）を開く  

**補足**: Wi‑Fiが「パブリックネットワーク」になっていると、`-Profile Private` だけでは届きません。`-Profile Any` で両方許可してください。  

### 原因2: スマホとPCが別ネットワーク

- スマホの **モバイルデータ（LTE/5G）をオフ** にし、**Wi‑Fiのみ** にする  
- スマホとPCが **同じWi‑Fi（同じSSID）** に接続されているか確認  
- ルーターの「**APアイソレーション（クライアント分離）**」がONだと、同じWi‑Fi同士でも通信できません。ルーターの設定でOFFにする  

### 原因3: 使っているIPが違う

- PCで `ipconfig` を実行し、**ワイヤレス LAN アダプター** の **IPv4** を確認（例: 192.168.0.181）  
- スマホで開くURLは **http://そのIP:3000**（例: http://192.168.0.181:3000）  
- **有線LAN** でPCをつないでいる場合は、「イーサネット アダプター」の IPv4 を使う  

---

## ⚠️ 「net::ERR_ADDRESS_UNREACHABLE」が出る場合

**そのIPアドレスへ届く経路がありません。** 下の **チェックリストを上から順に** やってください。

### チェックリスト（この順で）

1. **PCでURLを表示する**  
   `frontend` フォルダで PowerShell を開き、次を実行する：
   ```powershell
   cd "c:\Users\PC user\OneDrive\Desktop\udemy-langchain\english-training-app-clean\frontend"
   .\show-url.ps1
   ```
   表示された **http://192.168.x.x:3000** をメモする（数字は環境により異なる）。

2. **スマホのモバイルデータをオフにする**  
   - 設定 → ネットワーク/インターネット → **モバイルデータ（ cellular ）をオフ**  
   - またはクイック設定で **LTE/5G のアイコンをオフ**

3. **スマホをPCと同じWi‑Fiにする**  
   - 設定 → Wi‑Fi → **PCがつながっているのと同じSSID** を選択  
   - 「ゲスト」と「通常」が分かれている場合は、**PCと同じほう** にする

4. **スマホのブラウザでURLを開く**  
   - 手順1で表示されたURLを **そのまま** 入力（http:// と :3000 を忘れない）  
   - ブックマークや履歴の古いURLは使わず、**毎回手入力するか、PCで表示したURLをコピー** する

まだ「アドレスに到達できません」になる場合は、**ルーターの「APアイソレーション」「クライアント分離」がONになっていないか** をルーター設定で確認してください。

---

### 詳細な原因（上で解決しないとき）

- 192.168.x.x は **家庭内のWi‑Fi用のアドレス** です。  
- スマホが **LTE/5G（モバイルデータ）** だと、そのアドレスには絶対に届きません。  
- **設定 → Wi‑Fi** で、PCと同じSSIDのWi‑Fiに接続し、**モバイルデータをオフ** にしてから再度 **http://〈PCのIP〉:3000** を開く。

### 2. PCのIPを間違えている・IPが変わった

- PCで **PowerShell** を開き、`ipconfig` を実行。  
- **「ワイヤレス LAN アダプター Wi-Fi」** の **IPv4 アドレス** をそのまま使う（例: 192.168.0.181）。  
- 有線でつないでいるときは **「イーサネット アダプター」** の IPv4。  
- 一度Wi‑Fiを切り替えたりルーターを再起動したりするとIPが変わるので、**その都度 ipconfig で確認**する。

### 3. スマホとPCが別のネットワーク

- スマホ: **設定 → Wi‑Fi** で表示されている **SSID（ネットワーク名）** を確認。  
- PC: タスクバーのWi‑Fiアイコン → **接続中のSSID** を確認。  
- **完全に同じSSID** であること。  
- 「ゲストWi‑Fi」と「通常のWi‑Fi」は別ネットワークなので、両方とも同じほう（どちらか一方）に合わせる。

### 4. URLの打ち間違い

- **http://** を付ける（**https://** ではない）。  
- ポート **:3000** を付ける。  
- 例: `http://192.168.0.181:3000`（数字は自分のPCのIPに合わせる）

---

## 1. 開発サーバーを「LAN受け付け」で起動する

フロントは次のコマンドで起動してください（すでに `-H 0.0.0.0` を入れています）。

```powershell
cd frontend
npm run dev
```

起動ログに **Network: http://192.168.x.x:3000** のように表示されていれば、LANから接続可能な状態です。

---

## 2. PCのIPアドレスを確認する

スマホで打つURLは **http://〈PCのIP〉:3000** です。

**方法A（おすすめ）— スクリプトでURLを表示：**

```powershell
cd "c:\Users\PC user\OneDrive\Desktop\udemy-langchain\english-training-app-clean\frontend"
.\show-url.ps1
```

表示された **http://192.168.x.x:3000** をスマホでそのまま使います。

**方法B — 手動で確認：**

```powershell
ipconfig
```

「**ワイヤレス LAN アダプター**」の **IPv4 アドレス** を確認（例: `192.168.0.181`）。  
スマホのブラウザで開くURLは **http://192.168.0.181:3000** のようにします（自分の環境のIPに置き換え）。

---

## 3. 同じWi‑Fiか確認する

- スマホとPCを **同じWi‑Fi（同じSSID）** に接続する。
- スマホのモバイルデータはオフ、またはWi‑Fi優先にして、PCと同じネットワークになっているか確認する。

---

## 4. Windowsファイアウォールでポートを許可する

「接続できない」「時間切れ」になる場合、**ポート3000** がブロックされていることが多いです。

### 手順（Windows）

1. **Windows の検索** で「**ファイアウォール**」→「**Windows Defender ファイアウォールでアプリを許可する**」を開く。
2. **「設定の変更」** をクリック。
3. **「Node.js JavaScript Runtime」** を探す。  
   - **プライベート** にチェックを入れる（自宅Wi‑Fiは通常プライベート）。  
   - 一覧にない場合は **「別のアプリの許可」** から `node.exe` を追加し、**プライベート** を許可。
4. または **「詳細設定」** → **「受信の規則」** → **「新しい規則」** で、**ポート 3000**（TCP）を **許可** する。

設定後、もう一度スマホから **http://〈PCのIP〉:3000** を開き直してください。

---

## 5. スマホで「ホームに追加」する

1. スマホのブラウザで **http://〈PCのIP〉:3000** を開く。
2. メニュー（⋮ や「共有」）→ **「ホーム画面に追加」** または **「アプリをインストール」**。
3. 追加されたアイコンが、設定したPWAアイコンになっているか確認。

---

## うまくいかないとき

| 症状 | 確認すること |
|------|----------------|
| ページが開かない・タイムアウト | 同じWi‑Fiか、ファイアウォールで 3000 番を許可したか |
| PCのIPが分からない | `ipconfig` の「ワイヤレス LAN」の IPv4 |
| バックエンドAPIが動かない | スマホからは **PCのIP** でアクセスしているため、フロントの `rewrites` で `localhost:8000` に飛ぶ。バックエンドも **同じPC** で `python main.py` が動いているか確認 |

---

## まとめ

1. `npm run dev` で **Network: http://192.168.x.x:3000** が出ているか確認  
2. `ipconfig` で **PCのIPv4** を確認  
3. スマホを **同じWi‑Fi** に  
4. **ファイアウォール** でポート 3000（と Node）を許可  
5. スマホで **http://〈PCのIP〉:3000** を開く  

これで「スマホでうつらない」の多くは解消します。
